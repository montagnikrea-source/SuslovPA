<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Render System</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            overflow: auto;
        }
        .log-box {
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            background: #001;
            max-height: 500px;
            overflow-y: auto;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #0f0;
        }
        .pass {
            background: #001;
            border-left-color: #0f0;
        }
        .fail {
            background: #100;
            border-left-color: #f00;
        }
        .pending {
            background: #010;
            border-left-color: #ff0;
        }
        h2 {
            color: #0ff;
            border-bottom: 1px solid #0ff;
        }
        .debug-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .debug-table td {
            border: 1px solid #0f0;
            padding: 5px;
            text-align: left;
        }
        .debug-table th {
            background: #003;
            border: 1px solid #0f0;
            padding: 5px;
        }
    </style>
</head>
<body>

<h1>üîç Debug: Render System Diagnostics</h1>

<div class="log-box">
    <h2>1. DOM Elements Status</h2>
    <table class="debug-table">
        <tr>
            <th>Element ID</th>
            <th>Exists</th>
            <th>Tag</th>
            <th>Display</th>
            <th>Value/Width</th>
        </tr>
        <tbody id="elementsTable"></tbody>
    </table>
</div>

<div class="log-box">
    <h2>2. Function Tests</h2>
    <div id="functionsTests"></div>
</div>

<div class="log-box">
    <h2>3. Real-time Monitor (30 sec)</h2>
    <div id="monitor"></div>
    <button onclick="startMonitor()">Start Monitoring</button>
    <button onclick="stopMonitor()">Stop Monitoring</button>
</div>

<div class="log-box">
    <h2>4. Manual Test Panel</h2>
    <p>
        <input type="text" id="testId" placeholder="Element ID" value="freqValue">
        <input type="text" id="testValue" placeholder="Value" value="TEST_VALUE">
        <button onclick="testSetT()">Test setT()</button>
    </p>
    <p>
        <input type="text" id="testId2" placeholder="Element ID" value="freqBar">
        <input type="number" id="testPercent" placeholder="Percent" value="50" min="0" max="100">
        <button onclick="testSetW()">Test setW()</button>
    </p>
    <div id="testResults"></div>
</div>

<script>
let logs = [];
function log(msg) {
    console.log(msg);
    logs.push(msg);
}

// Elements to check
const elementsToCheck = [
    'freqValue', 'freqBar',
    'lrSlider', 'lrVal', 'lrBar', 'lrAuto',
    'l2Slider', 'l2Val', 'l2Bar', 'l2Auto',
    'mixSlider', 'mixVal', 'mixBar', 'mixAuto',
    'neuroOverlay', 'toggleNeuroAnim'
];

function checkDOMElements() {
    const table = document.getElementById('elementsTable');
    table.innerHTML = '';
    
    elementsToCheck.forEach(id => {
        const el = document.getElementById(id);
        const row = document.createElement('tr');
        
        let status = el ? '‚úÖ' : '‚ùå';
        let tag = el ? el.tagName : 'N/A';
        let display = el ? getComputedStyle(el).display : 'N/A';
        let value = 'N/A';
        
        if (el) {
            if (el.tagName === 'INPUT') value = el.value;
            else if (el.tagName === 'DIV' || el.tagName === 'SPAN') {
                value = `width: ${el.style.width || '(auto)'}, text: "${el.textContent.substring(0, 20)}"`;
            }
        }
        
        row.innerHTML = `<td>${id}</td><td>${status}</td><td>${tag}</td><td>${display}</td><td>${value}</td>`;
        row.className = el ? 'pass' : 'fail';
        table.appendChild(row);
    });
}

function testFunctions() {
    const container = document.getElementById('functionsTests');
    container.innerHTML = '';
    
    const tests = [];
    
    // Test 1: Check if setT is available
    tests.push({
        name: 'window.__setT exists',
        fn: () => typeof window.__setT === 'function' ? 'pass' : 'fail',
    });
    
    // Test 2: Check if setW is available
    tests.push({
        name: 'window.__setW exists',
        fn: () => typeof window.__setW === 'function' ? 'pass' : 'fail',
    });
    
    // Test 3: Check if $ helper exists
    tests.push({
        name: 'window.$ exists',
        fn: () => typeof window.$ === 'function' ? 'pass' : 'fail',
    });
    
    // Test 4: Try calling setT on a test element (if it doesn't exist, will warn)
    tests.push({
        name: 'setT can be called',
        fn: () => {
            try {
                if (window.__setT) {
                    window.__setT('__TEST__ELEMENT__', 'test');
                    return 'pass';
                }
                return 'fail';
            } catch(e) {
                return 'fail: ' + e.message;
            }
        },
    });
    
    // Test 5: Check scan object
    tests.push({
        name: 'scan object exists',
        fn: () => typeof window.scan !== 'undefined' ? 'pass' : 'fail',
    });
    
    // Test 6: Check if loop is running
    tests.push({
        name: 'loop function running',
        fn: () => {
            // Count how many times __setT was called in last 100ms
            const before = window.__setT_calls || 0;
            setTimeout(() => {
                window.__testSetTCallsAfter = window.__setT_calls || 0;
            }, 100);
            return 'running (check console logs)';
        },
    });
    
    tests.forEach(test => {
        const div = document.createElement('div');
        const result = test.fn();
        const className = result === 'pass' ? 'pass' : result === 'fail' ? 'fail' : 'pending';
        div.className = 'test-result ' + className;
        div.innerHTML = `<strong>${test.name}</strong>: ${result}`;
        container.appendChild(div);
        log(`[TEST] ${test.name}: ${result}`);
    });
}

let monitorInterval = null;
function startMonitor() {
    if (monitorInterval) return;
    
    const container = document.getElementById('monitor');
    container.innerHTML = '<p>Monitoring... Check console for [SET-T] and [SET-W] logs</p>';
    
    const initialSetTCalls = window.__setT_calls || 0;
    const initialSetWCalls = window.__setW_calls || 0;
    
    monitorInterval = setInterval(() => {
        const currentSetTCalls = window.__setT_calls || 0;
        const currentSetWCalls = window.__setW_calls || 0;
        
        const setTPerSec = (currentSetTCalls - initialSetTCalls) * 10;
        const setWPerSec = (currentSetWCalls - initialSetWCalls) * 10;
        
        container.innerHTML = `
            <table class="debug-table">
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                    <th>Per Second</th>
                </tr>
                <tr>
                    <td>setT() calls total</td>
                    <td>${currentSetTCalls}</td>
                    <td>~${setTPerSec}</td>
                </tr>
                <tr>
                    <td>setW() calls total</td>
                    <td>${currentSetWCalls}</td>
                    <td>~${setWPerSec}</td>
                </tr>
                <tr>
                    <td>scan.out_f</td>
                    <td>${window.scan?.out_f?.toFixed(3) || 'N/A'}</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>freqValue element</td>
                    <td>${document.getElementById('freqValue')?.textContent || 'empty'}</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>freqBar width</td>
                    <td>${document.getElementById('freqBar')?.style.width || 'auto'}</td>
                    <td>-</td>
                </tr>
            </table>
            <p><small>Real-time update every 100ms</small></p>
        `;
    }, 100);
}

function stopMonitor() {
    if (monitorInterval) {
        clearInterval(monitorInterval);
        monitorInterval = null;
    }
}

function testSetT() {
    const id = document.getElementById('testId').value;
    const value = document.getElementById('testValue').value;
    
    const results = document.getElementById('testResults');
    results.innerHTML = `<p>Testing setT("${id}", "${value}")</p>`;
    
    if (window.__setT) {
        results.innerHTML += `<p>Before: "${document.getElementById(id)?.textContent || 'element not found'}"</p>`;
        window.__setT(id, value);
        results.innerHTML += `<p>After: "${document.getElementById(id)?.textContent || 'element not found'}"</p>`;
        results.innerHTML += `<p style="color: #0f0;">‚úÖ setT() executed (check console for logs)</p>`;
    } else {
        results.innerHTML += `<p style="color: #f00;">‚ùå window.__setT not found</p>`;
    }
}

function testSetW() {
    const id = document.getElementById('testId2').value;
    const percent = document.getElementById('testPercent').value;
    
    const results = document.getElementById('testResults');
    results.innerHTML = `<p>Testing setW("${id}", ${percent})</p>`;
    
    if (window.__setW) {
        results.innerHTML += `<p>Before: "${document.getElementById(id)?.style.width || 'auto'}"</p>`;
        window.__setW(id, percent);
        results.innerHTML += `<p>After: "${document.getElementById(id)?.style.width || 'auto'}"</p>`;
        results.innerHTML += `<p style="color: #0f0;">‚úÖ setW() executed (check console for logs)</p>`;
    } else {
        results.innerHTML += `<p style="color: #f00;">‚ùå window.__setW not found</p>`;
    }
}

// Run initial checks
window.addEventListener('load', () => {
    setTimeout(() => {
        log('=== Initial Diagnostics ===');
        checkDOMElements();
        testFunctions();
        log('=== Diagnostics Complete ===');
    }, 1000);
});
</script>

</body>
</html>
